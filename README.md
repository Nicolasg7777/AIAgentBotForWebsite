# AI Support Agent for Website

This repo contains a **real AI-powered** customer support agent using **Google Gemini (FREE)**:
- ü§ñ Natural conversation AI (not just scripted responses)
- üí¨ Floating chat widget for WordPress (Hostinger) via WPCode snippet
- üéØ Reliably collects: name, email, phone, reason, availability
- üìÖ Schedules meetings via Calendly integration
- üóÑÔ∏è Logs all conversations to Supabase (free tier)
- üìä Admin dashboard to view logs, sessions, and upcoming meetings
- üìß Email reminders for meetings (Supabase Edge + Resend optional)
- üÜì **100% FREE** - Handles 20-25 concurrent users easily

## üÜï AI-Powered Features

**NEW:** Upgraded from simple rules to real AI!
- Uses Google Gemini 1.5 Flash (free tier: 60 req/min, 1,500/day)
- Natural conversation flow - no rigid step-by-step
- Structured prompt ensures reliable data collection
- Answers questions about your services intelligently
- Gracefully guides users toward booking meetings
- Fallback to simple FAQ mode if AI unavailable

**See [AI-GUIDE.md](AI-GUIDE.md) for full details on the AI integration**

## Quick Start (Deploy Today)

### Step 1: Supabase Setup (5 min)
1. Create free account at https://supabase.com
2. Create new project (note the URL and anon key)
3. Go to SQL Editor ‚Üí New Query
4. Paste the SQL schema below and run it
5. Copy your `SUPABASE_URL` and `SUPABASE_ANON_KEY` from Settings ‚Üí API

### Step 2: Calendly Setup (3 min)
1. Create free account at https://calendly.com
2. Set your availability (e.g., Mon-Fri 9am-5pm)
3. Create an event type (e.g., "15 Minute Meeting")
4. Copy your scheduling link (e.g., https://calendly.com/yourname/15min)

### Step 2.5: Get Free Gemini AI Key (2 min) ‚≠ê NEW
1. Go to https://aistudio.google.com/app/apikey
2. Sign in with Google account
3. Click "Create API Key"
4. Copy the key (starts with `AI...`)
5. **This enables natural AI conversations!**

### Step 3: Configure Widget (2 min)
1. Open `web/wpcode-snippet.html`
2. Replace these values:
   - `YOUR_SUPABASE_URL` ‚Üí your Supabase URL
   - `YOUR_SUPABASE_ANON_KEY` ‚Üí your anon key
   - `https://calendly.com/yourname/15min` ‚Üí your Calendly link
   - `Support Bot` ‚Üí your preferred bot name
   - `YOUR_GEMINI_API_KEY` ‚Üí your Gemini API key ‚≠ê NEW
3. Save the file

### Step 4: Add to WordPress (3 min)
1. WordPress Admin ‚Üí WPCode ‚Üí Add Snippet
2. Choose "Add Your Custom Code (New Snippet)"
3. Select "JavaScript Snippet"
4. Paste contents of `web/wpcode-snippet.html`
5. Location: Footer, Priority: 1
6. Toggle to "Active" and click "Save Snippet"
7. Visit your website - you should see the chat button bottom-right!

### Step 5: Deploy Dashboard (5 min)
1. Go to https://pages.cloudflare.com
2. Sign up/login with GitHub
3. Create new project ‚Üí Connect to Git
4. Select this repo ‚Üí Begin setup
5. Build settings: Framework = None, Build output = `web`
6. Deploy
7. Access dashboard at provided URL
8. Enter your Supabase URL and key to view logs

## Environment Variables

Create a `.env` file (or paste into WPCode snippet inline config):
- SUPABASE_URL
- SUPABASE_ANON_KEY
- CALENDLY_LINK (e.g., https://calendly.com/yourname/15min)
- SUPPORT_AGENT_NAME (e.g., "Crescendo Support Bot")
- GEMINI_API_KEY (‚≠ê NEW - enables AI mode)

For email reminders (optional):
- RESEND_API_KEY (https://resend.com free tier)
- REMINDER_FROM_EMAIL (e.g., support@yourdomain.com)

**AI Mode:** Set `USE_AI: true` in config to enable natural conversations. Set to `false` for simple FAQ mode.

## Supabase Schema
Run this SQL in Supabase SQL editor:

```sql
create table if not exists profiles (
  id uuid primary key default gen_random_uuid(),
  full_name text,
  email text,
  phone text,
  created_at timestamptz default now()
);

create table if not exists sessions (
  id uuid primary key default gen_random_uuid(),
  profile_id uuid references profiles(id) on delete set null,
  started_at timestamptz default now(),
  last_activity_at timestamptz default now(),
  status text default 'open'
);

create table if not exists messages (
  id bigint generated by default as identity primary key,
  session_id uuid references sessions(id) on delete cascade,
  sender text check (sender in ('user','bot')),
  content text,
  created_at timestamptz default now()
);

create table if not exists bookings (
  id uuid primary key default gen_random_uuid(),
  session_id uuid references sessions(id) on delete set null,
  profile_id uuid references profiles(id) on delete set null,
  calendly_link text,
  scheduled_for timestamptz,
  reminder_email_sent boolean default false,
  created_at timestamptz default now()
);
```

Enable Row Level Security and add policies for anonymous insert/select (minimally scoped) if needed.

## WordPress Embed (Hostinger)
- Install WPCode (already shown in screenshots)
- Add a new snippet of type JavaScript
- Preferred: paste `web/wpcode-snippet.html` content directly (includes CSS + JS in one block)
- Or: paste the content of `web/chat-widget.js` within a `<script>` tag and add CSS from `web/chat-widget.css` in a CSS snippet or within the same snippet using `<style>`
- Set `Location: <head>` or `Footer` and set `Priority: 1`
- Publish

Before pasting, replace PLACEHOLDER values in the script with your Supabase and Calendly.

## Dashboard Hosting

### Option 1: Cloudflare Pages (Recommended - Free)
1. Create account at https://pages.cloudflare.com
2. Connect your GitHub repo or drag-and-drop the `web` folder
3. Build settings:
   - Framework preset: None
   - Build command: (leave empty)
   - Build output directory: `web` or `/`
4. Deploy
5. Access your dashboard at the provided URL (e.g., `yourproject.pages.dev`)
6. Set environment variables in Pages settings if needed

### Option 2: Hostinger File Manager
1. Log into Hostinger control panel
2. Open File Manager ‚Üí `public_html`
3. Create a folder `dashboard` and upload `web/dashboard.html` and `web/dashboard.js`
4. Access at `https://yourwebsite.com/dashboard/dashboard.html`
5. Secure with .htaccess password protection

## Email Reminders (Optional)
Add a Supabase Edge Function `send-reminders` that queries upcoming bookings and sends emails via Resend.
Trigger it daily using Supabase cron.

### Setup Email Reminders
1. Create free Resend account: https://resend.com
2. Verify your domain or use test email
3. Get API key from Resend dashboard
4. In Supabase Dashboard ‚Üí Edge Functions:
   - Create function `send-reminders`
   - Paste code from `web/edge-send-reminders.js`
   - Set environment variables:
     - `RESEND_API_KEY`
     - `REMINDER_FROM_EMAIL` (e.g., support@yourdomain.com)
5. Go to Database ‚Üí Cron Jobs ‚Üí Create job:
   - Name: `daily-reminders`
   - Schedule: `0 9 * * *` (9 AM daily)
   - Command: `SELECT net.http_post(url := 'YOUR_EDGE_FUNCTION_URL')`

## SMS Reminders (Optional - Paid)
For SMS reminders, use Twilio:
1. Create Twilio account (free trial: https://www.twilio.com/try-twilio)
2. Get Account SID and Auth Token
3. Get a Twilio phone number
4. Modify `web/edge-send-reminders.js` to include SMS:
```javascript
// Add after email sending
const twilioSid = Deno.env.get('TWILIO_ACCOUNT_SID');
const twilioToken = Deno.env.get('TWILIO_AUTH_TOKEN');
const twilioFrom = Deno.env.get('TWILIO_PHONE_NUMBER');

if (b.profiles?.phone) {
  const smsBody = `Reminder: Meeting on ${b.scheduled_for}. Reply to confirm.`;
  await fetch(`https://api.twilio.com/2010-04-01/Accounts/${twilioSid}/Messages.json`, {
    method: 'POST',
    headers: {
      'Authorization': 'Basic ' + btoa(`${twilioSid}:${twilioToken}`),
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: new URLSearchParams({
      From: twilioFrom,
      To: b.profiles.phone,
      Body: smsBody
    })
  });
}
```
5. Set environment variables in Supabase Edge Function:
   - `TWILIO_ACCOUNT_SID`
   - `TWILIO_AUTH_TOKEN`
   - `TWILIO_PHONE_NUMBER`

## Development
- `web/chat-widget.js`: main widget logic
- `web/chat-widget.css`: styles and button
- `web/dashboard.html` + `web/dashboard.js`: admin dashboard
- `web/wpcode-snippet.html`: combined snippet for WordPress
- `web/edge-send-reminders.js`: Supabase Edge Function for reminders

## Git Workflow
```powershell
# Initialize repo (if not already done)
git init

# Stage all files
git add .

# Commit
git commit -m "Add AI support agent with widget, dashboard, and reminders"

# Set main branch
git branch -M main

# Add remote (replace with your repo URL)
git remote add origin https://github.com/YOUR_USERNAME/AIAgentBotForWebsite.git

# Push
git push -u origin main
```

## Limitations
- SMS reminders require a paid provider (Twilio trial possible). Email reminders supported free via Resend.
- The bot uses **Google Gemini AI** for natural conversations (free tier: 60 req/min). Falls back to simple FAQ if API unavailable.
- Gemini free tier limits: 1,500 requests/day, 1M tokens/month (enough for 20-25 concurrent users).
- For details on AI capabilities, see [AI-GUIDE.md](AI-GUIDE.md)

