<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Support Agent Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@latest/css/pico.min.css"/>
  <style>
    .tab-buttons { display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #e2e8f0; }
    .tab-buttons button { background: none; border: none; padding: 1rem; cursor: pointer; border-bottom: 3px solid transparent; }
    .tab-buttons button.active { border-bottom-color: #2b6cb0; color: #2b6cb0; font-weight: 600; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .success { color: #10b981; font-weight: 600; }
    .error { color: #ef4444; font-weight: 600; }
    .code-block { background: #1e293b; color: #f8fafc; padding: 1rem; border-radius: 8px; overflow-x: auto; margin: 1rem 0; position: relative; }
    .copy-btn { position: absolute; top: 0.5rem; right: 0.5rem; padding: 0.5rem 1rem; background: #2b6cb0; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .copy-btn:hover { background: #2c5282; }
    .credential-section { background: #f8fafc; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; }
    .status-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.875rem; font-weight: 600; }
    .status-connected { background: #d1fae5; color: #065f46; }
    .status-disconnected { background: #fee2e2; color: #991b1b; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: white; padding: 2rem; border-radius: 8px; max-width: 600px; max-height: 80vh; overflow-y: auto; }
    .modal-close { float: right; cursor: pointer; font-size: 1.5rem; }
  </style>
</head>
<body>
  <div id="googleCalendarModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeGoogleCalendarSetup()">‚úï</span>
      <h3>Google Calendar Setup (5 minutes)</h3>
      <ol>
        <li>Go to <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
        <li>Create a new project (name: "AI Support Agent")</li>
        <li>Enable "Google Calendar API"
          <ul><li>Search for "Google Calendar API"</li>
          <li>Click "Enable"</li></ul>
        </li>
        <li>Create OAuth 2.0 credentials
          <ul><li>Go to "Credentials"</li>
          <li>Click "Create Credentials" ‚Üí "OAuth client ID"</li>
          <li>Choose "Web application"</li>
          <li>Add authorized redirect URI: <code id="redirectUri">https://yoursite.com/dashboard.html</code></li>
          <li>Copy your Client ID</li></ul>
        </li>
        <li>Paste Client ID below</li>
        <li>Click "Connect Google Calendar"</li>
      </ol>
      <label>Google OAuth Client ID <input id="googleClientId" placeholder="Your Client ID from Google Cloud Console"/></label>
      <button onclick="saveGoogleClientId()">Save Client ID</button>
    </div>
  </div>
  <main class="container">
    <h2>AI Support Agent Dashboard</h2>
    
    <div class="tab-buttons">
      <button class="active" onclick="showTab('setup')">‚öôÔ∏è Setup</button>
      <button onclick="showTab('analytics')">üìä Analytics</button>
      <button onclick="showTab('bookings')">üìÖ Bookings</button>
      <button onclick="showTab('snippet')">üìã Get Code</button>
    </div>

    <!-- Setup Tab -->
    <div id="setup" class="tab-content active">
      <h3>One-Click Setup</h3>
      <p>Enter your credentials below and we'll handle the rest!</p>

      <div class="credential-section">
        <h4>1Ô∏è‚É£ Supabase (Database)</h4>
        <label>Supabase URL <input id="supabaseUrl" placeholder="https://yourproject.supabase.co"/></label>
        <label>Supabase Anon Key <input id="supabaseKey" type="password" placeholder="eyJhbGc..."/></label>
        <button id="testSupabase" onclick="testSupabase()">Test Connection</button>
        <span id="supabaseStatus"></span>
      </div>

      <div class="credential-section">
        <h4>2Ô∏è‚É£ Google Gemini AI (Free)</h4>
        <p><small>Get your free API key: <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com/app/apikey</a></small></p>
        <label>Gemini API Key <input id="geminiKey" type="password" placeholder="AIzaSy..."/></label>
        <button onclick="testGemini()">Test AI</button>
        <span id="geminiStatus"></span>
      </div>

      <div class="credential-section">
        <h4>3Ô∏è‚É£ Calendly (Scheduling)</h4>
        <p><small>Get your link: <a href="https://calendly.com" target="_blank">calendly.com</a> ‚Üí Event Types ‚Üí Copy link</small></p>
        <label>Calendly Link <input id="calendlyLink" placeholder="https://calendly.com/yourname/15min"/></label>
        <label>Support Agent Name <input id="agentName" placeholder="Support Bot"/></label>
      </div>

      <div class="credential-section">
        <h4>4Ô∏è‚É£ Resend (Email Reminders - Optional)</h4>
        <p><small>Get free API key: <a href="https://resend.com/api-keys" target="_blank">resend.com/api-keys</a> (3,000 emails/month free)</small></p>
        <label>Resend API Key <input id="resendKey" type="password" placeholder="re_..."/></label>
        <label>From Email <input id="fromEmail" placeholder="support@yourdomain.com"/></label>
        <button onclick="testEmail()">Send Test Email</button>
        <span id="emailStatus"></span>
      </div>

      <div class="credential-section">
        <h4>6Ô∏è‚É£ Google Calendar (Optional - Auto-Create Events)</h4>
        <p><small>Auto-create calendar events when someone books. <a href="#" onclick="showGoogleCalendarSetup(); return false;">Click here for setup instructions</a></small></p>
        <button onclick="connectGoogleCalendar()">üîó Connect Google Calendar</button>
        <span id="calendarStatus"></span>
        <button id="disconnectCalendarBtn" style="display:none;" onclick="disconnectGoogleCalendar()">‚ùå Disconnect Calendar</button>
      </div>

      <button onclick="saveConfig()" style="background: #10b981;">üíæ Save Configuration</button>
      <button onclick="generateSnippet()" style="background: #2b6cb0;">üöÄ Generate WordPress Code</button>
    </div>

    <!-- Analytics Tab -->
    <div id="analytics" class="tab-content">
      <h3>Traffic & Sessions</h3>
      <table>
        <thead><tr><th>Session</th><th>Profile</th><th>Status</th><th>Last Activity</th></tr></thead>
        <tbody id="sessionsBody"></tbody>
      </table>
    </div>

    <!-- Bookings Tab -->
    <div id="bookings" class="tab-content">
      <h3>Scheduled Meetings</h3>
      <table>
        <thead><tr><th>When</th><th>Name</th><th>Email</th><th>Phone</th><th>Calendly</th><th>Calendar Event</th><th>Reminder</th><th>Actions</th></tr></thead>
        <tbody id="bookingsBody"></tbody>
      </table>
    </div>

    <!-- Snippet Tab -->
    <div id="snippet" class="tab-content">
      <h3>Your WordPress Code (WPCode Snippet)</h3>
      <p>Copy and paste this into WordPress ‚Üí WPCode ‚Üí Add Snippet ‚Üí JavaScript</p>
      <div class="code-block">
        <button class="copy-btn" onclick="copySnippet()">üìã Copy</button>
        <pre id="generatedSnippet">Click "Generate WordPress Code" in the Setup tab first!</pre>
      </div>
      
      <h4>Installation Steps:</h4>
      <ol>
        <li>WordPress Admin ‚Üí WPCode ‚Üí Add Snippet</li>
        <li>Choose "Add Your Custom Code (New Snippet)"</li>
        <li>Select "JavaScript Snippet"</li>
        <li>Paste the code above</li>
        <li>Location: <strong>Footer</strong>, Priority: <strong>1</strong></li>
        <li>Toggle to <strong>Active</strong></li>
        <li>Click "Save Snippet"</li>
        <li>Visit your website - chat button appears bottom-right!</li>
      </ol>
    </div>

    <!-- Google Calendar Setup Modal -->
    <div id="googleCalendarModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeGoogleCalendarSetup()">‚úï</span>
        <h3>Google Calendar Setup (5 minutes)</h3>
        <p><strong>Step 1: Create Google Cloud Project</strong></p>
        <ol>
          <li>Go to <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></li>
          <li>Click "Select a project" ‚Üí "New Project"</li>
          <li>Name it "AI Support Agent Calendar"</li>
          <li>Wait for creation (~2 min)</li>
        </ol>
        <p><strong>Step 2: Enable Google Calendar API</strong></p>
        <ol>
          <li>Search for "Google Calendar API" in the search bar</li>
          <li>Click it, then click "Enable"</li>
          <li>Wait for the API to be enabled</li>
        </ol>
        <p><strong>Step 3: Create OAuth 2.0 Credentials</strong></p>
        <ol>
          <li>Go to "Credentials" in the left sidebar</li>
          <li>Click "Create Credentials" ‚Üí "OAuth 2.0 Client ID"</li>
          <li>Choose "Web application"</li>
          <li>Name it "AI Support Agent"</li>
          <li><strong>Authorized redirect URIs:</strong> Add your dashboard URL (e.g., <code>https://yourdomain.com/dashboard.html</code>)</li>
          <li>Click "Create"</li>
        </ol>
        <p><strong>Step 4: Copy Your Client ID</strong></p>
        <p>Copy the <strong>Client ID</strong> from the popup and paste it below:</p>
        <input type="text" id="googleClientId" placeholder="Your Client ID here" style="width: 100%; padding: 8px; margin: 10px 0;">
        <p><small>Don't worry about Client Secret - we don't need it for this setup.</small></p>
        <button onclick="saveGoogleClientId()" style="background: #4285F4; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">‚úì Save Client ID</button>
      </div>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>
